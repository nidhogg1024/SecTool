import{an as z,t as D,aD as H,d as O}from"./vendor-D2QpS8Sq.js";import{u as k,m as S,a as b,n as x,o as W,q as w,r as T,v as $,w as j,x as q,p as E}from"./tool-5AMbjt3J.js";import{l as n}from"./vendor-lodash-BDISS5yc.js";const P=async(i,{input:e="input",keyword:g=u=>!1,paste:y=u=>!0}={})=>{const u=k(),f=S(u.items.tool,u.items.feature),l=H(),_=b(),a=t=>{var I;const c=(I=l.query)==null?void 0:I[t];return n.isString(c)?c:""},r=(()=>{const t=a("keyword");return t===""?!1:g(t)})(),s=t=>(e&&n.isNumber(i[e])&&t[e]&&(t[e]=n.toNumber(t[e])),{items:n.cloneDeep(t),field:e});e&&!(e in i)&&(e="",y=!1);const p=e&&$(i[e]);i=r?n.merge(i,r):i;const o=n.cloneDeep(i);if(e){const t=j.get("_temp_input_storage")||a("input");if(t!=="")return p?(o[e].value=t,s(o)):s({...o,[e]:t})}const v=a("history")!==""?f.get(parseInt(a("history"))):null;if(v)return s(n.mergeWith(o,v,(t,c)=>{if(x(t))return t.unserialize(c)}));const h=(()=>{if(f.length()<1)return null;if(r){const t=f.all();for(const c in t)if(q(r,t[c].v))return f.getWithTime(parseInt(c));return null}return f.getWithTime(0)})(),m=await(async()=>{if(e&&y!==!1&&_.items.auto_read_copy){const t=await E();if(t.trim()&&y(t))return _.items.auto_read_copy_filter?t.trim():t}return""})();return h&&(m===""||O().unix()-O(h.t).unix()<_.items.fill_history_expire)?(console.log("use latest history data"),s(n.mergeWith(o,h.v,(t,c)=>{if(x(t))return t.unserialize(c)}))):m?(console.log("use paste data"),p?(o[e].value=_.items.auto_read_copy_filter?m.trim():m,s(o)):s({...o,[e]:_.items.auto_read_copy_filter?m.trim():m})):s(o)},U=i=>{const e=k(),g=S(e.items.tool,e.items.feature),y=b(),u=z(i.items),f=n.debounce(()=>{const a=r=>{if(!n.isObject(r))return r;if(x(r)){if(!r.isSaveHistory())throw new Error("Do not save");return r.serialize()}for(const s in r)r[s]=a(r[s]);return r};try{g.push(a(n.cloneDeep(D(u))))}catch{}},500),l=()=>{f()};return{current:u,save:l,success:({message:a=$t("main_ui_success"),message_type:r="success",copy_text:s="",copy_image:p="",is_save:o=!0}={})=>{if(o&&l(),s!==""&&y.items.auto_save_copy)return W(s,()=>{w.success($t("main_ui_copy_text_ok"))});if(p!==""&&y.items.auto_save_copy)return T(p,()=>{w.success($t("main_ui_copy_image_ok"))});a!==""&&w[r](a,{offset:150})}}};export{P as i,U as u};
