var S=Object.defineProperty;var O=(n,t,e)=>t in n?S(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var g=(n,t,e)=>O(n,typeof t!="symbol"?t+"":t,e);import{a as N,m as R,W as A,b as V,c as H,d as B,e as P,f as j}from"./vendor-monaco-CZQ85J0D.js";import{l as m}from"./vendor-lodash-BDISS5yc.js";import{h as w,J as I,i as F,e as T,s as z,j as G}from"./tool-Tf4xlnLR.js";import{l as K,av as J,h as y,k as X,o as q,w as L,u as p,H as U,y as Q,z as Y,A as E,C as Z,q as ee,D as te,O as ne,aw as oe,ax as ie}from"./vendor-D2QpS8Sq.js";import"./modulepreload-polyfill-B5Qt9EMX.js";const re=()=>[{id:"sectool_multiple_selection",label:$t("component_editor_multiple"),contextMenuGroupId:"1_modification",enable:!0,run:(n,t)=>{n.trigger(t,"editor.action.insertCursorAtEndOfEachLineSelected","")}},{id:"sectool_search",label:$t("component_editor_search"),contextMenuGroupId:"1_modification",enable:!0,run:(n,t)=>{n.trigger(t,"editor.action.startFindReplaceAction",null)}},{id:"sectool_goto",label:$t("component_editor_goto"),contextMenuGroupId:"1_modification",enable:!0,run:n=>n.trigger("","editor.action.gotoLine",null)},{id:"sectool_beautify",label:$t("code_beautify"),run:async n=>{var t;(t=n.getModel())!=null&&t.getLanguageId()}},{id:"sectool_compress",label:$t("code_compress"),run:async n=>{var t;(t=n.getModel())!=null&&t.getLanguageId()}},{id:"sectool_line_wrapping",label:$t("component_editor_line_wrapping"),enable:!0,run:n=>(n.updateOptions({wordWrap:n.getRawOptions().wordWrap==="off"?"on":"off"}),n.getRawOptions().wordWrap==="on")},{id:"sectool_line_number",label:$t("component_editor_line_number"),enable:!0,run:n=>(n.updateOptions({lineNumbers:n.getRawOptions().lineNumbers==="off"?"on":"off"}),n.getRawOptions().lineNumbers==="on")}];class ae{constructor(t){g(this,"editor");g(this,"handles",{});g(this,"_disposed",!1);this.editor=t,this.initMenu(),this.editor.onDidChangeModelLanguage(e=>{this.toggle("sectool_beautify",w.isEnable(e.newLanguage,"beautify")),this.toggle("sectool_compress",w.isEnable(e.newLanguage,"compress")),this.removeDefaultMenu()}),this.removeDefaultMenu(),this.editor.onDidDispose(()=>{this._disposed=!0})}removeDefaultMenu(){setTimeout(()=>{this._disposed||(this.editor.createContextKey("editorHasDocumentFormattingProvider",!1),this.editor.createContextKey("editorHasReferenceProvider",!1),this.editor.createContextKey("editorHasDefinitionProvider",!1),this.editor.createContextKey("editorHasDocumentSelectionFormattingProvider",!1),this.editor.createContextKey("editorHasMultipleDocumentFormattingProvider",!1),this.editor.createContextKey("editorHasMultipleDocumentSelectionFormattingProvider",!1))},200)}initMenu(){let t=1e3;re().forEach(e=>{const l={id:e.id,precondition:e.id,label:e.label,contextMenuGroupId:e.contextMenuGroupId||"sectool",contextMenuOrder:t++,run:i=>{var o,a,s,d;if(e.run){const c=e.run(i,e.id);(a=(o=this.handles)[e.id])==null||a.call(o,i,e.id,c);return}(d=(s=this.handles)[e.id])==null||d.call(s,i,e.id)}};this.toggle(e.id,!!e.enable),this.editor.addAction(l)})}setHandle(t,e){this.handles[t]=e}toggle(t,e){return this.editor.createContextKey(t,e)}}const se=(n,t)=>{var o;const e=m.trimEnd((o=t.getModel())==null?void 0:o.getValueInRange({startLineNumber:n.startLineNumber,endLineNumber:n.endLineNumber+1,startColumn:n.startColumn-1,endColumn:Number.MAX_SAFE_INTEGER}),",");let l="";try{if(["{","["].includes(e[0]))l=I.parse(e,{JSON_REPAIR:!0});else{const a=I.parse(`{${e}}`,{JSON_REPAIR:!0});m.isPlainObject(a)&&Object.keys(a).length>0&&(l=a[Object.keys(a)[0]])}}catch{}let i=0;m.isArray(l)&&(i=l.length),m.isPlainObject(l)&&(i=Object.keys(l).length),!(i<1)&&t.createDecorationsCollection([{range:{startColumn:0,endColumn:Number.MAX_SAFE_INTEGER,startLineNumber:n.startLineNumber,endLineNumber:n.startLineNumber},options:{after:{content:`${i}`,inlineClassName:"sectool-monaco-editor-line-info"}}}])},le=n=>{var i,o,a;const t=n.getVisibleRanges();if(t.length===0)return;const e=t[0];for(let s=e.startLineNumber;s<=e.endLineNumber;s++)(i=n.getLineDecorations(s))==null||i.filter(d=>{var c,h;return(h=(c=d.options.after)==null?void 0:c.inlineClassName)==null?void 0:h.includes("sectool-monaco-editor-line-info")}).forEach(d=>{n.removeDecorations([d.id])});if(((o=n.getModel())==null?void 0:o.getLanguageId())!=="json")return;(((a=n.getDecorationsInRange(e))==null?void 0:a.filter(s=>{var d,c;return(c=(d=s.options)==null?void 0:d.firstLineDecorationClassName)==null?void 0:c.includes("codicon-folding-")}))||[]).filter(s=>s.range.startLineNumber>=e.startLineNumber&&s.range.startLineNumber<=e.endLineNumber).forEach(s=>{se(s.range,n)})},de=m.debounce(n=>{setTimeout(()=>le(n),100)},300);class ue{constructor(t){g(this,"editor");g(this,"_status",!1);this.editor=t,this.init()}init(){this.editor.onDidScrollChange(()=>this.render()),this.editor.onDidChangeModelLanguage(()=>this.render()),this.editor.onDidChangeModel(()=>this.render()),this.editor.onDidChangeModelContent(()=>this.render()),setTimeout(()=>this.render(),500)}status(t){var e;if(this._status=t,this.render(),!this._status){const l=((e=this.editor.getModel())==null?void 0:e.getAllDecorations().filter(i=>{var o,a;return(a=(o=i.options.after)==null?void 0:o.inlineClassName)==null?void 0:a.includes("sectool-monaco-editor-line-info")}).map(i=>i.id))||[];l.length>0&&this.editor.removeDecorations(l)}}render(){if(this._status)return de(this.editor)}}const b=new Map,x=n=>{if(!b.has(n.getId())){const t=n.getId();b.set(t,new ue(n)),n.onDidDispose(()=>{b.delete(t)})}return b.get(n.getId())};self.MonacoEnvironment={getWorker(n,t){return t==="json"?new A:t==="css"||t==="scss"||t==="less"?new V:t==="html"||t==="handlebars"||t==="razor"?new H:t==="typescript"||t==="javascript"?new B:new P}};const W=()=>N.__getMonacoInstance(),ce=(n={})=>(N.config({monaco:R,...n}),N.init()),_=class _{constructor(t,e){g(this,"domNode");this.placeholder=t,this.editor=e,e.onDidChangeModelContent(()=>this.onDidChangeModelContent()),this.onDidChangeModelContent()}onDidChangeModelContent(){this.editor.getValue()===""?this.editor.addContentWidget(this):this.editor.removeContentWidget(this)}getId(){return _.ID}getDomNode(){return this.domNode||(this.domNode=document.createElement("div"),this.domNode.style.width="max-content",this.domNode.style.pointerEvents="none",this.domNode.textContent=this.placeholder,this.domNode.style.fontStyle="italic",this.editor.applyFontInfo(this.domNode)),this.domNode}getPosition(){return{position:{lineNumber:1,column:1},preference:[j.ContentWidgetPositionPreference.EXACT]}}dispose(){this.editor.removeContentWidget(this)}};g(_,"ID","editor.widget.placeholderHint");let M=_;const _e=K({__name:"Editor",props:oe({toolbar:{type:String,default:"bottom-right"},lang:{type:String,default:"text"},placeholder:{type:String,default:()=>$t("main_ui_input")},langCallback:{type:[Function,Boolean],default:()=>!1},reload:{type:Number,default:0},height:{type:[String,Number],default:"100%"},disableLineWrapping:{type:Boolean,default:!1},disableBorder:{type:Boolean,default:!1},disableLineNumbers:{type:Boolean,default:!1},disableClear:{type:Boolean,default:!1},lineInfo:{type:Boolean,default:!1}},{modelValue:{default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(n){const t=J(n,"modelValue"),e=n,l=F(),i=y(null),o=ie(null),a=y(!e.disableLineWrapping),s=y(!e.disableLineNumbers),d=r=>{let f=r;return e.langCallback!==!1&&(f=e.langCallback()||r),G(f)},c=async()=>{var f,u;if(!o.value)return;x(o.value).status(e.lineInfo);const r=o.value.getModel();r&&((f=W())==null||f.editor.setModelLanguage(r,d(e.lang).id)),(u=W())==null||u.editor.setTheme(l.theme.raw==="dark"?"vs-dark":"vs"),o.value.render(!0)},h=async r=>{o.value&&o.value.dispose(),ce({"vs/nls":{availableLanguages:{"*":$t("main_locale")==="zh_CN"?"zh-cn":"en"}}}).then(f=>{const u=f.editor.create(r,{value:p(t.value),minimap:{enabled:!1},lineNumbers:s.value?"on":"off",wordWrap:a.value?"on":"off",language:d(e.lang).id,scrollbar:{verticalScrollbarSize:5},automaticLayout:!0});u.onDidChangeModelContent(()=>{u.getValue()!==p(t.value)&&(t.value=u.getValue())}),new M(e.placeholder,u);const D=new ae(u);x(u).status(e.lineInfo),D.setHandle("sectool_line_wrapping",(k,$,C)=>a.value=C),D.setHandle("sectool_line_number",(k,$,C)=>s.value=C),o.value=u,c()})};X(async()=>{!e.disableClear&&T.addListener("content_clear",()=>v()),await h(i.value)}),q(()=>{var r;return(r=o.value)==null?void 0:r.dispose()});const v=(r="")=>{o.value&&o.value.getValue()!==r&&o.value.setValue(r)};return L(()=>({value:p(t.value)}),({value:r})=>{if(o.value)return v(r);const f=setInterval(()=>{o.value&&clearInterval(f),v(r)},50)}),L(()=>({color:l.theme.raw,lang:e.lang,reload:e.reload,lineInfo:e.lineInfo}),()=>c()),(r,f)=>{const u=U("Display");return Q(),Y(u,{position:e.toolbar,class:ne(["sectool-code-editor",e.disableBorder?["sectool-code-editor-disable-border"]:[]]),style:te({height:`${p(z)(e.height)}`,width:"100%"}),toggle:""},{extra:E(()=>[ee(r.$slots,"default")]),default:E(()=>[Z("div",{ref_key:"container",ref:i,style:{height:"100%",width:"100%"}},null,512)]),_:3},8,["position","class","style"])}}});export{_e as default};
